var __extends=this.__extends||function(n,t){function r(){this.constructor=n}for(var i in t)t.hasOwnProperty(i)&&(n[i]=t[i]);r.prototype=t.prototype;n.prototype=new r};define(["require","exports","khesht/utils","khesht/ext/bootstrap/dom","khesht/element"],function(n,t,i,r,u){return function(t){function u(i,u){t.call(this,r.form($.extend({action:n.toUrl("api")+"/",method:"POST"},u)));this.inputTypes="input,select,textarea";this.page=i;this.addHidden("callback",this.page.url)}return __extends(u,t),u.prototype.setDefaults=function(n){var t=this;i.each(n,function(n,i){t.set(n,i)})},u.prototype.disable=function(n){r.disable(this[n])},u.prototype.enable=function(n){r.enable(this[n])},u.prototype.set=function(n,t){var i=this[n];i&&(i.val(t),i.attr("type")=="hidden"&&i.trigger("change"))},u.prototype.br=function(n){n===void 0&&(n=null);this.append(r.br(n))},u.prototype.hr=function(){this.append(r.hr())},u.prototype.addInput=function(n,t,i,u,f,e,o){i===void 0&&(i=!1);u===void 0&&(u="");f===void 0&&(f=null);o===void 0&&(o=!0);t=t instanceof jQuery?t:r.box().append(t).css({padding:"7px"});var s=u?r.labeledControl(t,u,f,e).append(o?r.br(2):null):r.div().append(t,o?r.br():null).children();return this.append(s),n&&(this[n+"_wrapper"]=s,this[n]=this[n+"_wrapper"].find(this.inputTypes).attr("name",n).data("required",i)),t},u.prototype.addDescription=function(n,t){this.append(r.p().append(r.glyphicon(t)," ",n))},u.prototype.addSection=function(n,t){t===void 0&&(t="bookmark");this.append(r.pageHeader().append(r.h2().append(r.glyphicon(t)," ",n)))},u.prototype.addHidden=function(n,t){this.append(this[n]=r.hidden({name:n,value:t}))},u.prototype.addSubmit=function(n){return r.button(null,n).addClass("btn-lg btn-block btn-success").appendTo(this.dom).click(this.submit.bind(this))},u.prototype.submit=function(){var n=this;this.dom.find(".has-error").removeClass("has-error");this.dom.find(this.inputTypes).each(function(t,i){var r=$(i),s=s=="file"?i.files:r.attr("type"),e=r.val(),h=r.attr("name"),f=!1,o;if(e)switch(s){case"email":f=!u.validateEmail(e);break;case"password":o=n.pass||n.password;f=h=="repass"&&o&&e!=o.val()}else r.data("required")&&(f=!0);f&&n.inputWrapper(r.attr("name")).addClass("has-error")});this.dom.find(".has-error").length==0?this.dom.submit():this.onvalidationfail()},u.prototype.onvalidationfail=function(){this.page.addMessage("validation_fail","fail")},u.prototype.inputWrapper=function(n){return this[n+"_wrapper"]},u.validateEmail=function(n){return new RegExp(/^((([a-z]|\d|[!#\$%&'\*\+\-\/=\?\^_`{\|}~]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])+(\.([a-z]|\d|[!#\$%&'\*\+\-\/=\?\^_`{\|}~]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])+)*)|((\x22)((((\x20|\x09)*(\x0d\x0a))?(\x20|\x09)+)?(([\x01-\x08\x0b\x0c\x0e-\x1f\x7f]|\x21|[\x23-\x5b]|[\x5d-\x7e]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(\\([\x01-\x09\x0b\x0c\x0d-\x7f]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF]))))*(((\x20|\x09)*(\x0d\x0a))?(\x20|\x09)+)?(\x22)))@((([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])*([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])))\.)+(([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])*([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])))\.?$/i).test(n)},u}(u)})